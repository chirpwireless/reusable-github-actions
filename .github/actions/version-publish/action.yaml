name: 'Publish Version'
description: 'Publishes build version for use by deploy scripts'

inputs:
  commit-sha:
    description: 'SHA of commit to publish version check'
    default: ${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}
    required: false
  build-version:
    description: 'Version of build generated by commit'
    required: true
  check-name:
    description: 'The name of the version check to publish'
    required: false
    default: 'chirp:version'
  github-token:
    description: 'The GitHub token'
    required: true
    default: ${{ github.token }}

runs:
  using: 'composite'
  steps:
    - uses: actions/github-script@v7
      env:
        COMMIT_SHA: ${{ inputs.commit-sha }}
        BUILD_VERSION: ${{ inputs.build-version }}
        CHECK_NAME: ${{ inputs.check-name }}
      with:
        github-token: ${{ inputs.github-token }}
        script: |
          const { publishVersion } = require(`${process.env.GITHUB_ACTION_PATH}/script.js`)
          return publishVersion({ github, context, core });